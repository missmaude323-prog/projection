<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Projections Terminal</title>
<style>
  :root {
    --bg:#0b0b0c; --fg:#e8e8e8; --sub:#9aa0a6; --cyan:#00e5ff; --dc:#005b66;
    --mag:#ff8de3; --green:#7CFC00; --yellow:#ffe066; --red:#ff6961;
    --card:#151517; --border:#2a2a2e; --rowAlt:#151517;
  }
  html,body {
    margin:0; background:var(--bg); color:var(--fg);
    font:clamp(12px,2.7vw,16px)/1.45 ui-monospace,SFMono-Regular,Menlo,Consolas,"Liberation Mono",monospace;
    overflow-x:hidden;
  }
  .term { max-width:640px; margin:0 auto; padding:18px }
  .bar { color:var(--cyan) }
  .sep { color:var(--dc) }

  /* Report table */
  table.report { width:100%; border-collapse:collapse; margin:12px 0; }
  table.report tr:nth-child(even){ background:var(--rowAlt); }
  table.report td{ padding:4px 4px; vertical-align:top; }
  table.report td:first-child{ color:var(--mag); white-space:nowrap; padding-right:.75em; }
  table.report td:last-child{ color:var(--fg) }

  .yellow{ color:var(--yellow) }
  .green{ color:var(--green) }
  .red{ color:var(--red) }
  .sub{ color:var(--sub) }

  .btns{ margin-top:14px; display:flex; gap:8px; flex-wrap:wrap }
  button{
    background:var(--card); color:#fff; border:1px solid var(--border);
    padding:9px 11px; border-radius:9px; font:inherit; cursor:pointer; min-width:96px;
  }
  button:active{ transform:translateY(1px) }

  .center{ display:flex; align-items:center; justify-content:center; min-height:120px }
  .cat{ white-space:pre; line-height:1.05 }
  .spin{ display:inline-block; transform-origin:center center;
         -webkit-animation:spin 1.2s linear infinite; animation:spin 1.2s linear infinite; }
  .shake{ -webkit-animation:shake .42s cubic-bezier(.36,.07,.19,.97) both;
          animation:shake .42s cubic-bezier(.36,.07,.19,.97) both; }

  @-webkit-keyframes spin{from{-webkit-transform:rotate(0)}to{-webkit-transform:rotate(360deg)}}
  @keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}
  @-webkit-keyframes shake{10%,90%{-webkit-transform:translate3d(-1px,0,0)}
    20%,80%{-webkit-transform:translate3d(2px,0,0)}
    30%,50%,70%{-webkit-transform:translate3d(-3px,0,0)}
    40%,60%{-webkit-transform:translate3d(3px,0,0)}}
  @keyframes shake{10%,90%{transform:translate3d(-1px,0,0)}
    20%,80%{transform:translate3d(2px,0,0)}
    30%,50%,70%{transform:translate3d(-3px,0,0)}
    40%,60%{transform:translate3d(3px,0,0)}}

  @media (max-width:480px){
    html,body{ font-size:14px }
    .term{ padding:14px }
    table.report td{ display:block; width:100% }
    table.report td:last-child{ padding-left:1em }
  }
</style>
</head>
<body>
<div class="term" id="term">
  <div class="bar" id="title"></div>
  <div class="sep" id="sep"></div>
  <div class="yellow" id="subject"></div>
  <div id="screen"></div>
  <div class="btns">
    <button id="again">Run again</button>
    <button id="share">Share</button>
  </div>
  <div class="sub" style="margin-top:10px">
    Tip: add <code>?v=10</code> to bust cache. Add <code>?reset=1</code> to see first-visit mode again (on your device only).
  </div>
</div>

<script>
(() => {
  // ===== personalize defaults (override with ?n=&co=) =====
  const defaults={n:"Walter",co:"Life Insurance Co."};
  const qs=new URLSearchParams(location.search);
  const name=qs.get('n')||defaults.n;
  const co=qs.get('co')||defaults.co;
  // ========================================================

  const term=document.getElementById('term');
  const title=document.getElementById('title');
  const sep=document.getElementById('sep');
  const subj=document.getElementById('subject');
  const screen=document.getElementById('screen');
  const again=document.getElementById('again');
  const share=document.getElementById('share');

  // --- visit memory (first visit = bullish, later = cautious) ---
  const VISIT_KEY='pt_visitCount_v1';
  if (qs.get('reset')==='1') { try { localStorage.removeItem(VISIT_KEY); } catch(e){} }
  let visitCount=0;
  try { visitCount = parseInt(localStorage.getItem(VISIT_KEY)||'0',10) || 0; } catch(e){ visitCount=0; }
  const isFirstVisit = visitCount===0;
  try { localStorage.setItem(VISIT_KEY, String(visitCount+1)); } catch(e){}

  const sleep=ms=>new Promise(r=>setTimeout(r,ms));
  const pad=n=>(''+n).padStart(2,'0');

  function header(){
    const d=new Date();
    const ttl=`Projections Terminal ‚Äî ${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`;
    title.textContent=ttl;
    sep.textContent='='.repeat(ttl.length);
    subj.textContent=`Subject: ${name}`;
  }
  function clearScreen(){ screen.innerHTML=''; }

  // spinny cat
  const catArt=` /\\_/\\  \n( o.o ) \n > ^ < `;
  async function showCats(){
    clearScreen();
    const wrap=document.createElement('div'); wrap.className='center';
    const msg=document.createElement('div'); msg.className='yellow';
    msg.textContent='üê± Spinning up market data...';
    const cat=document.createElement('pre'); cat.className='cat spin'; cat.textContent=catArt;
    wrap.appendChild(msg); wrap.appendChild(cat); screen.appendChild(wrap);
    await sleep(1200); clearScreen();
  }

  // helpers
  const rndInt=(min,max)=>Math.floor(Math.random()*(max-min+1))+min;
  const rndBeta=()=> (rndInt(16,19)/10).toFixed(2); // 1.6‚Äì1.9
  const rndHyrox=()=> rndInt(86,100);               // 86‚Äì100

  function sparkline(icon){
    const bars=['‚ñÅ','‚ñÇ','‚ñÉ','‚ñÑ','‚ñÖ','‚ñÜ','‚ñá']; let out='';
    for(let i=0;i<20;i++) out+=bars[(Math.random()*bars.length)|0];
    return out+'  '+icon;
  }

  function report(){
    const beta=rndBeta();
    const hy=rndHyrox();

    // Mode-specific fields
    const mode = isFirstVisit ? 'bullish' : 'cautious';
    const rating   = mode==='bullish' ? 'STRONG BUY  ‚ù§Ô∏è' : 'HOLD ‚Äî under review';
    const sentiment= mode==='bullish' ? 'Ultra Bullish' : 'Cautiously bearish';
    const replyProb= mode==='bullish' ? rndInt(70,95) : rndInt(20,65); // first-time looks good, later is cooler
    const notesBull=[
      'Premium waived for clever banter.',
      'Dividend payout in smiles upon reply.',
      'Policyholder owes one coffee date for compliance.',
      'Projected synergy high; follow-up recommended.'
    ];
    const notesCool=[
      'Policy lapse risk rises with poor communication.',
      'Premium waived for clever banter (pending response).',
      'Premium discount applied for admission of blushing.',
      'Compliance flag: response time trending long.'
    ];
    const uw = (mode==='bullish' ? notesBull : notesCool)[(Math.random()*4)|0];

    const table=document.createElement('table'); table.className='report';
    [
      ['Role',              `AVP, Finance ‚Äî ${co}`],
      ['Analyst Rating',    rating],
      ['Chemistry Beta',    beta],
      ['Sentiment',         sentiment],
      ['Reply Probability', `${replyProb}% this week`],
      ['HYROX Index',       `${hy}/100 ‚Äî built for endurance`],
      ['Underwriting Note', uw],
      ['Insider Tip',       'Run due diligence: coffee with me.']
    ].forEach(([k,v])=>{
      const tr=document.createElement('tr');
      const td1=document.createElement('td'); td1.textContent=k;
      const td2=document.createElement('td'); td2.textContent=v;
      tr.appendChild(td1); tr.appendChild(td2); table.appendChild(tr);
    });
    screen.appendChild(table);

    const pa=document.createElement('div');
    pa.className= isFirstVisit ? 'green' : 'yellow';
    pa.textContent='Price Action:  '+sparkline(isFirstVisit ? 'üìà' : '‚ö†Ô∏è');
    screen.appendChild(pa);

    const msg=document.createElement('div');
    msg.style.marginTop='8px';
    if (isFirstVisit) {
      msg.className='yellow';
      msg.textContent=`‚ú® ${name}, don't keep me waiting ‚Äî I'm free next week. ‚ú®`;
    } else {
      msg.className='red';
      msg.textContent=`Note: response time trending bearish ‚Äî upgrade recommended.`;
    }
    screen.appendChild(msg);
  }

  // ticker (mode changes tone)
  function tickerCols(){
    const w=innerWidth;
    if(w<380) return 4; if(w<430) return 5; if(w<520) return 6; return 7;
  }
  async function ticker(){
    const cols=tickerCols();
    const cellW=9;

    const tokensBull=['$HOT','BUY','$WALT','$LUV','$DATE','$COFFEE','$ROI‚Üë','$BETA1.8','$QTRWIN'];
    const emojisBull=['','üî• ','üí∏ '];

    const tokensCool=['$HOT','HOLD','$AFK','$LATE','$DATE','$COFFEE','$ROI?','$BETA1.8','$QTR?'];
    const emojisCool=['','‚è≥ ','‚ö†Ô∏è ','ü•∂ '];

    const tok = isFirstVisit ? tokensBull : tokensCool;
    const emo = isFirstVisit ? emojisBull : emojisCool;

    for(let i=0;i<24;i++){
      let rowTxt='';
      for(let j=0;j<cols;j++){
        const token=tok[Math.floor(Math.random()*tok.length)] || '$HOT';
        const e=emo[Math.floor(Math.random()*emo.length)];
        rowTxt+=(e+token).padEnd(cellW,' ')+' ';
      }
      const d=document.createElement('div');
      d.className = isFirstVisit ? 'green' : 'yellow';
      d.textContent=rowTxt;
      screen.appendChild(d);
      await sleep(70);
    }
  }

  async function runOnce(){ header(); await showCats(); report(); await ticker(); }

  // shake + rerun
  again.addEventListener('click', async ()=>{
    term.classList.remove('shake'); void term.offsetWidth; term.classList.add('shake');
    clearScreen(); await runOnce();
    term.addEventListener('animationend',()=>term.classList.remove('shake'),{once:true});
    window.scrollTo({top:document.body.scrollHeight,behavior:'smooth'});
  });

  // share (keeps current personalization)
  share.addEventListener('click', async ()=>{
    const url=new URL(location.href);
    url.searchParams.set('n',name); url.searchParams.set('co',co);
    try{
      if(navigator.share){ await navigator.share({title:'Projections Terminal', url:url.toString()}); }
      else if(navigator.clipboard){ await navigator.clipboard.writeText(url.toString()); alert('Link copied!'); }
      else{ prompt('Copy link:', url.toString()); }
    }catch(e){ alert('Could not share: '+e); }
  });

  header(); runOnce();
})();
</script>
</body>
</html>